<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en" 
      th:fragment="parent(content, leftContent, rightContent, leftHeading, rightHeading)">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="/images/favicon.png" />
    <title>AuxVent App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .sidebar { transition: all 0.3s ease-in-out; max-height: calc(100vh - 120px); overflow-y: auto; }
        .main-content { transition: all 0.3s ease-in-out; max-height: calc(100vh - 120px); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-gray-50 text-gray-700 pt-[64px] pb-[48px]">

<div data-th-replace="~{navbar :: navbar}"></div>

<div class="flex-grow flex flex-row w-full p-4 gap-4" id="layoutRow">

    <!-- Left Sidebar -->
    <div id="showLeftBtn" class="hidden items-start">
        <button onclick="toggleSidebar('leftSidebar', 'showLeftBtn')" class="p-2 bg-white rounded-full shadow-md hover:bg-gray-200 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
            </svg>
        </button>
    </div>

    <aside id="leftSidebar" th:if="${leftContent != null}" 
           class="sidebar w-64 min-w-[16rem] bg-white border border-gray-200 rounded-2xl shadow-sm p-4 flex flex-col gap-4">
        <div class="flex justify-between items-center">
            <h3 class="text-lg font-semibold text-gray-800" data-th-text="${leftHeading}">Summary</h3>
            <button onclick="toggleSidebar('leftSidebar', 'showLeftBtn')" class="p-2 hover:bg-gray-100 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
                </svg>
            </button>
        </div>
        <div data-th-replace="${leftContent}"></div>
    </aside>

    <!-- Main Content -->
    <main id="mainContent" class="main-content flex-grow flex flex-col p-6 bg-white border border-gray-200 shadow-sm rounded-2xl overflow-y-auto">
        <section data-th-replace="${content}" class="flex flex-col items-center w-full gap-5"></section>
    </main>

    <!-- Right Sidebar -->
    <aside id="rightSidebar" th:if="${rightContent != null}" 
           class="sidebar w-72 min-w-[18rem] bg-white border border-gray-200 rounded-2xl shadow-sm p-4 flex flex-col gap-4">
        <div class="flex justify-between items-center">
            <button onclick="toggleSidebar('rightSidebar', 'showRightBtn')" class="p-2 hover:bg-gray-100 rounded-full">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
                 </svg>
            </button>
            <h3 class="text-lg font-semibold text-gray-800" data-th-text="${rightHeading}">Actions</h3>
        </div>
        <div data-th-replace="${rightContent}"></div>
    </aside>

    <div id="showRightBtn" class="hidden items-start">
        <button onclick="toggleSidebar('rightSidebar', 'showRightBtn')" class="p-2 bg-white rounded-full shadow-md hover:bg-gray-200 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
            </svg>
        </button>
    </div>
</div>

<div data-th-replace="~{chatbot :: chatbot}"></div>
<div data-th-replace="~{footer :: footer}"></div>

<!-- Inject calculator fragment -->
<div data-th-replace="~{calculators :: calculators}"></div>
<script>
function toggleSidebar(sidebarId, showBtnId) {
    const sidebar = document.getElementById(sidebarId);
    const showBtn = document.getElementById(showBtnId);
    sidebar.classList.toggle('hidden');
    showBtn.classList.toggle('hidden');
}
</script>

</body>
</html>
